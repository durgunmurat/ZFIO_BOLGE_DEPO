<mvc:View
    controllerName="com.sut.bolgeyonetim.controller.GoodsReceipt"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns="sap.m"
    xmlns:f="sap.f"
    xmlns:core="sap.ui.core">
    <Page
        title="Mal Kabul"
        showNavButton="true"
        navButtonPress="onNavBack">
        <content>
            <!-- LEVEL 1: License Plates List (Black Box in Screenshot) -->
            <List
                id="idL1List"
                items="{goodsReceiptModel>/}"
                noDataText="Bekleyen mal kabul kaydı bulunamadı">
                <items>
                    <!-- L1 Panel: Each License Plate -->
                    <CustomListItem>
                        <Panel
                            expandable="true"
                            expanded="false"
                            class="sapUiSmallMarginBottom">
                            <headerToolbar>
                                <OverflowToolbar>
                                    <core:Icon src="sap-icon://shipping-status" size="1.5rem" color="#0854A0"/>
                                    <Title text="{goodsReceiptModel>PlateNumber}" level="H3" class="sapUiTinyMarginBegin"/>
                                    <ToolbarSpacer/>
                                    <Label text="DB: {goodsReceiptModel>Warehouse}"/>
                                    <Label text="ÜY: {goodsReceiptModel>WerksText}" class="sapUiTinyMarginBegin"/>
                                    <Button
                                        text="Foto (0/5)"
                                        press="onPhotoPress"
                                        class="sapUiTinyMarginBegin"/>
                                    <Button
                                        text="Mal Kabul"
                                        type="Emphasized"
                                        press="onMalKabulPress"
                                        enabled="false"
                                        class="sapUiTinyMarginBegin"/>
                                </OverflowToolbar>
                            </headerToolbar>
                            <content>
                                <VBox>
                                    <!-- LEVEL 2: Delivery Notes List (Red Box in Screenshot) -->
                                    <List
                                        items="{goodsReceiptModel>ToDeliveryNotes/results}"
                                        mode="None"
                                        noDataText="İrsaliye bulunamadı">
                                        <CustomListItem>
                                            <HBox alignItems="Center" justifyContent="SpaceBetween" width="100%">
                                                <HBox alignItems="Center">
                                                    <CheckBox select="onDeliveryNoteSelect"/>
                                                    <VBox class="sapUiTinyMarginBegin">
                                                        <Text text="İrsaliye No: {goodsReceiptModel>DeliveryNumber}"/>
                                                        <Text text="{= parseInt(${goodsReceiptModel>TotalMaterialNo}) } farklı ürün" class="sapUiTinyMarginTop"/>
                                                    </VBox>
                                                </HBox>
                                            </HBox>
                                        </CustomListItem>
                                    </List>

                                    <!-- LEVEL 3: Category Filters + Items Table (Purple Box in Screenshot) -->
                                    <VBox class="sapUiSmallMarginTop" visible="false">
                                        <!-- Category Filters (Blue Box in Screenshot) -->
                                        <IconTabBar
                                            select="onCategoryFilterSelect"
                                            class="sapUiSmallMarginBottom"
                                            upperCase="false">
                                            <items>
                                                <IconTabFilter key="all" text="Tümü" count="0"/>
                                                <IconTabSeparator/>
                                            </items>
                                        </IconTabBar>

                                        <!-- Items Table -->
                                        <Table
                                            items="{itemsModel>/}"
                                            inset="false"
                                            growing="true"
                                            growingThreshold="20"
                                            noDataText="Lütfen bir irsaliye seçin">
                                            <columns>
                                                <Column width="6em"><Text text="KOD"/></Column>
                                                <Column minScreenWidth="Tablet" demandPopin="true"><Text text="ÜRÜN ADI"/></Column>
                                                <Column minScreenWidth="Desktop" demandPopin="true" hAlign="Center"><Text text="KATEGORİ"/></Column>
                                                <Column width="6em" hAlign="Right"><Text text="MİKTAR"/></Column>
                                                <Column width="5em" hAlign="Center"><Text text="SAYIM"/></Column>
                                                <Column width="4em" hAlign="Center"><Text text="SM"/></Column>
                                                <Column width="7em" hAlign="Center"><Text text="İŞLEM"/></Column>
                                            </columns>
                                            <items>
                                                <ColumnListItem>
                                                    <cells>
                                                        <Text text="{= parseInt(${itemsModel>Material}) }"/>
                                                        <Text text="{itemsModel>MaterialText}"/>
                                                        <Text text="{itemsModel>KategoriText}"/>
                                                        <ObjectNumber
                                                            number="{itemsModel>ReceivedQuantity}"
                                                            unit="{itemsModel>UoM}"
                                                            state="None"/>
                                                        <Input
                                                            value="{itemsModel>ExpectedQuantity}"
                                                            type="Number"
                                                            textAlign="Center"
                                                            width="100%"
                                                            editable="false"
                                                            change="onCountChange"/>
                                                        <Text text="{itemsModel>SM}"/>
                                                        <Button
                                                            text="{= ${itemsModel>Approved} === 'X' ? 'Düzenle' : 'Onayla' }"
                                                            type="Emphasized"
                                                            press="onApproveItem"
                                                            icon="{= ${itemsModel>Approved} === 'X' ? 'sap-icon://edit' : 'sap-icon://accept' }"/>
                                                    </cells>
                                                </ColumnListItem>
                                            </items>
                                        </Table>
                                    </VBox>
                                </VBox>
                            </content>
                        </Panel>
                    </CustomListItem>
                </items>
            </List>
        </content>
    </Page>
</mvc:View>